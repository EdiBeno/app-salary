<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ ××©×ª××©×™×</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; background: #111; color: #eee; }
        h2 { text-align: center; margin-top: 20px; }
        table { width: 95%; margin: 20px auto; border-collapse: collapse; background: #1e1e1e; }
        th, td { border: 1px solid #444; padding: 8px; text-align: center; }
        th { background: #333; }
        .controls-row {
            width: 95%;
            margin: 10px auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .back-button, .delete-button, .print-button, .renew-button, .reset-link-button {
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }
        .back-button { background: #555; color: #fff; }
        .delete-button { background: #b00020; color: #fff; }
        .print-button { background: #1976d2; color: #fff; }
        .renew-button { background: #388e3c; color: #fff; }
        .reset-link-button { background: #7b1fa2; color: #fff; margin-top: 4px; }
        .active { color: #4caf50; font-weight: bold; }
        .expired { color: #f44336; font-weight: bold; }
        .select-box { transform: scale(1.2); }
    </style>
</head>
<body>

    <h2>××©×ª××©×™× ×©× ×¨×©××•</h2>

    <!-- ×©×•×¨×ª ×›×¤×ª×•×¨×™× ×¢×œ×™×•× ×” -->
    <div class="controls-row">
        <!-- ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª -->
        <a href="{{ url_for('index') }}" class="back-button">â¬…ï¸ ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</a>

        <!-- ××—×™×§×ª ××©×ª××©×™× × ×‘×—×¨×™× -->
        <form id="delete-form" method="POST" action="{{ url_for('delete_selected_users') }}"
              onsubmit="return confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”××©×ª××©×™× ×©× ×‘×—×¨×•?');">
            <button type="submit" class="delete-button">ğŸ—‘ï¸ ××—×§ × ×‘×—×¨×™×</button>
        </form>

        <!-- ×”×“×¤×¡×” -->
        <button type="button" onclick="window.print()" class="print-button">ğŸ–¨ï¸ ×”×“×¤×¡ ×¨×©×™××”</button>
    </div>

    <!-- ×˜×‘×œ×” -->
    <table>
        <thead>
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th>×©× ××©×ª××©</th>
                <th>××™××™×™×œ</th>
                <th>×ª×¤×§×™×“</th>
                <th>× ×¨×©× ×‘×ª××¨×™×š</th>
                <th>×›× ×™×¡×” ××—×¨×•× ×”</th>
                <th>×¡×˜×˜×•×¡ ×’×™×©×”</th>
                <th>×–××Ÿ × ×•×ª×¨ (×©× ×™×•×ª)</th>
                <th>× ×™×”×•×œ ×’×™×©×”</th>
                <th>× ×™×”×•×œ ×ª×¤×§×™×“</th>
                <th>×§×™×©×•×¨ ×§×‘×™×¢×ª ×¡×™×¡××”</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <!-- ×‘×—×™×¨×” ×œ××—×™×§×” -->
                <td>
                    <input type="checkbox" name="delete_ids" value="{{ user.id }}"
                           class="select-box" form="delete-form">
                </td>

                <!-- ×©× -->
                <td>{{ user.username or user.email }}</td>

                <!-- ××™××™×™×œ -->
                <td>{{ user.email }}</td>

                <!-- ×ª×¤×§×™×“ -->
                <td>{{ user.role }}</td>

                <!-- × ×¨×©× -->
                <td>
                    {% if user.created_at %}
                        {{ user.created_at.strftime('%d/%m/%Y %H:%M') }}
                    {% else %}
                        ×œ× ×–××™×Ÿ
                    {% endif %}
                </td>

                <!-- ×›× ×™×¡×” ××—×¨×•× ×” -->
                <td>
                    {% if user.last_login %}
                        {{ user.last_login.strftime('%d/%m/%Y %H:%M') }}
                    {% else %}
                        ×œ× × ×›× ×¡ ×¢×“×™×™×Ÿ
                    {% endif %}
                </td>

                <!-- ×¡×˜×˜×•×¡ ×’×™×©×” -->
                <td class="{% if 'â›”' in user.status_label %}expired{% else %}active{% endif %}">
                    {{ user.status_label }}
                </td>

                <!-- ×–××Ÿ × ×•×ª×¨ -->
                <td>
                    {% if user.seconds_left is not none and user.seconds_left > 0 %}
                        {{ user.seconds_left }}
                    {% elif user.seconds_left == 0 %}
                        ×¤×’ ×ª×•×§×£
                    {% else %}
                        ×œ×œ× ×”×’×‘×œ×”
                    {% endif %}
                </td>

                <!-- × ×™×”×•×œ ×’×™×©×” (×¡×˜×˜×•×¡ + ×–××Ÿ) -->
                <td>
                    {% if is_owner %}
                    <form method="POST" action="{{ url_for('update_access') }}">
                        <input type="hidden" name="email" value="{{ user.email }}">

                        <!-- ×¡×˜×˜×•×¡ -->
                        <select name="status">
                            <option value="active"
                                {% if 'âœ…' in user.status_label %}selected{% endif %}>×¤×¢×™×œ</option>
                            <option value="blocked"
                                {% if '×—×¡×•×' in user.status_label %}selected{% endif %}>×—×¡×•×</option>
                        </select>

                        <!-- ×–××Ÿ ×’×™×©×” -->
                        <select name="duration">
                            <option value="">×œ×œ× ×”×’×‘×œ×”</option>
                            <option value="900">15 ×“×§×•×ª</option>
                            <option value="1800">30 ×“×§×•×ª</option>
                            <option value="3600">1 ×©×¢×”</option>
                            <option value="43200">12 ×©×¢×•×ª</option>
                            <option value="86400">1 ×™×•×</option>
                            <option value="604800">1 ×©×‘×•×¢</option>
                            <option value="2592000">1 ×—×•×“×©</option>
                            <option value="31536000">1 ×©× ×”</option>
                        </select>

                        <button type="submit" class="renew-button">×¢×“×›×Ÿ</button>
                    </form>
                    {% else %}
                        ××™×Ÿ ×”×¨×©××”
                    {% endif %}
                </td>

                <!-- × ×™×”×•×œ ×ª×¤×§×™×“ -->
                <td>
                    {% if is_owner %}
                    <form method="POST" action="{{ url_for('update_role') }}">
                        <input type="hidden" name="email" value="{{ user.email }}">
                        <select name="role" onchange="this.form.submit()">
                            <option value="customer" {% if user.role == 'customer' %}selected{% endif %}>×œ×§×•×—</option>
                            <option value="employee" {% if user.role == 'employee' %}selected{% endif %}>×¢×•×‘×“</option>
                            <option value="owner" {% if user.role == 'owner' %}selected{% endif %}>×‘×¢×œ×™×</option>
                        </select>
                    </form>
                    {% else %}
                        {{ user.role }}
                    {% endif %}
                </td>

                <!-- ×©×œ×™×—×ª ×œ×™× ×§ ×§×‘×™×¢×ª ×¡×™×¡××” -->
                <td>
                    {% if is_owner %}
                    <form method="POST" action="{{ url_for('send_reset_link') }}">
                        <input type="hidden" name="email" value="{{ user.email }}">
                        <button type="submit" class="reset-link-button">
                            ×©×œ×— ×œ×™× ×§ ×¡×™×¡××”
                        </button>
                    </form>
                    {% else %}
                        -
                    {% endif %}
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // ×¡×™××•×Ÿ ×›×œ ×”×¦'×§×‘×•×§×¡×™×
        document.getElementById('select-all').addEventListener('change', function () {
            const checked = this.checked;
            document.querySelectorAll('.select-box').forEach(cb => {
                cb.checked = checked;
            });
        });
    </script>

    <!--  DevTools F12 Browser Blocker Script  -->
    <script disable-devtool-auto src="https://cdn.jsdelivr.net/npm/disable-devtool"></script>

</body>
</html>
